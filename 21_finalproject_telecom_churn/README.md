 Обучение моделей для прогноза оттока клиентов для телеком-компании

**Описание проекта**

Оператор связи «ТелеДом» хочет бороться с оттоком клиентов. Для этого его сотрудники начнут предлагать промокоды и специальные условия всем, кто планирует отказаться от услуг связи. Чтобы заранее находить таких пользователей, «ТелеДому» нужна модель, которая будет предсказывать, разорвёт ли абонент договор. Команда оператора собрала персональные данные о некоторых клиентах, информацию об их тарифах и услугах. Ваша задача — обучить на этих данных модель для прогноза оттока клиентов.

**Описание услуг**

Оператор предоставляет два основных типа услуг:
- Стационарную телефонную связь. Телефон можно подключить к нескольким линиям одновременно.
- Интернет. Подключение бывает двух типов: через телефонную линию DSL (от англ. digital subscriber line — «цифровая абонентская линия») или оптоволоконный кабель (англ. fiber optic).

Также абонентам доступен ряд услуг:
- Интернет-безопасность: антивирус (Device Protection) и блокировка опасных сайтов (Online Security);
- Выделенная линия технической поддержки (Tech Support);
- Облачное хранилище файлов для резервного копирования данных (Online Backup);
- Стриминговое телевидение (Streaming TV) и каталог фильмов (Streaming Movies).

За услуги клиенты могут платить ежемесячно или раз в 1–2 года. Доступны различные способы расчёта и возможность получить электронный чек.

**Описание данных**

Данные хранятся в базе данных PostgreSQL. Она состоит из нескольких таблиц:
- **contract** — информация о договорах;
- **personal** — персональные данные клиентов;
- **internet** — информация об интернет-услугах;
- **phone** — информация об услугах телефонии.

Таблица telecom.contract
- **customerID** — ID абонента;
- **BeginDate** — дата начала действия договора;
- **EndDate** — дата окончания действия договора;
- **Type** — тип оплаты: раз в год-два или ежемесячно;
- **PaperlessBilling** — электронный расчётный лист;
- **PaymentMethod** — тип платежа;
- **MonthlyCharges** — расходы за месяц;
- **TotalCharges** — общие расходы абонента.

Таблица personal
- **customerID** — ID пользователя;
- **gender** — пол;
- **SeniorCitizen** — является ли абонент пенсионером;
- **Partner** — есть ли у абонента супруг или супруга;
- **Dependents** — есть ли у абонента дети.

Таблица telecom.internet
- **customerID** — ID пользователя;
- **InternetService** — тип подключения;
- **OnlineSecurity** — блокировка опасных сайтов;
- **OnlineBackup** — облачное хранилище файлов для резервного копирования данных;
- **DeviceProtection** — антивирус;
- **TechSupport** — выделенная линия технической поддержки;
- **StreamingTV** — стриминговое телевидение;
- **StreamingMovies** — каталог фильмов.

Таблица telecom.phone
- **customerID** — ID пользователя;
- **MultipleLines** — подключение телефона к нескольким линиям одновременно.

Информация о договорах актуальна на 1 февраля 2020.


**Инструкция по выполнению проекта**

**Шаг 1. Загрузите данные**
Подключитесь к базе данных, используйте для этого код:

db_config = {
'user': 'praktikum_student',# имя пользователя,'pwd': 'Sdf4$2;d-d30pp',# пароль,'host': 'rc1b-wcoijxj3yxfsf3fs.mdb.yandexcloud.net',
'port': 6432,# порт подключения,'db': 'data-science-final'# название базы данных,
}
 
При выполнении проекта задайте константу RANDOM_STATE. Её значение будет равно дате начала вашей работы над проектом. Например, если это 1 сентября 2022 года, то RANDOM_STATE = 10922. Используйте эту константу везде, где это необходимо: например при разделении данных на выборки.

**Шаг 2. Проведите исследовательский анализ и предобработку данных**
- Проанализируйте исходные данные. Проверьте:
    - Все ли таблицы содержат данные.
    - Соответствует ли количество таблиц условию задачи.
- Для каждой таблицы:
    - Проведите исследовательский анализ данных: проверьте наличие пропусков и аномалий, изучите распределение признаков.
    - Обработайте аномалии с учётом особенностей услуг телекоммуникации.
- Объедините таблицы по ID клиента:
    - Каждому клиенту должно соответствовать одно наблюдение. При объединении учитывайте особенности услуг телекоммуникации.
    - Попробуйте сгенерировать новые признаки, которые могут пригодиться при обучении. Например, рассчитайте длительность контракта абонента.
    - Выделите в целевую переменную признак EndDate.
    - Проведите исследовательский анализ данных объединённой таблицы, при необходимости заполните пропуски и визуализируйте распределение каждого признака.
    - Визуализируйте соотношение ушедших и оставшихся клиентов для каждого признака.
    - Проведите корреляционный анализ.
- Подготовьте данные для обучения:
    - Выберите признаки, которые будете использовать для обучения, учитывайте особенности данных и выбранных моделей. Перед вами не стоит задача временных рядов, поэтому не стоит использовать даты как входные признаки модели.
    - Если вы сгенерируете новый признак «Длительность контракта абонента», то не используйте его одновременно с любыми другими производными признака BeginDate — например с годом заключения договора. Это приведёт к утечке целевого признака.
    - Разделите данные на тренировочную и тестовую выборки (test_size = 0.25).
    - Подготовьте выборки для обучения, учитывайте особенности выбранных моделей.

**Шаг 3. Обучите модель**
- Рассмотрите классы моделей:
    - решающее дерево или случайный лес,
    - бустинги,
    - нейронные сети.
- Найдите лучшую модель для прогноза оттока клиентов. Оцените её качество метрикой ROC-AUC. Выберите лучшую модель по значению метрики на кросс-валидации.
- Подберите значения как минимум двум гиперпараметрам хотя бы для одной модели. Лучше всего использовать методы автоматизированного подбора гиперпараметров: GridSearchCV, RandomizedSearchCV, OptunaSearchCV, Optuna и другие.

**Шаг 4. Протестируйте модель и продемонстрируйте её работу**
- Проверьте качество лучшей модели на тестовой выборке. Значение метрики ROC-AUC должно быть не менее 0.85. Для интерпретируемости модели дополнительно выведите значение accuracy.
- Постройте матрицу ошибок лучшей модели. Отобразите полноту и точность модели на графике.
- Проанализируйте важность основных входных признаков, влияющих на отток клиентов.
- Для одного из важных входных признаков проведите дополнительное исследование:
    - Покажите график зависимости входного и целевого признаков.

**Шаг 5. Сделайте общий вывод по работе**
- Напишите общие выводы, предложите способы для дальнейшего улучшения модели и дайте бизнес-рекомендации заказчику. 

Содержание

1.  Знакомство с данными
    - 1.1  Определение и загрузка библиотек
    - 1.2  Создание частоиспользуемых функций
    - 1.3 Загрузка данных
    - 1.4 Вывод
2.  Предобработка данных
    - 2.1 Таблица contract
    - 2.2 Таблица personal
    - 2.3 Таблица intenet
    - 2.4 Таблица phone
    - 2.5 Объединение таблицы по ID клиента
    - 2.6 Преобразование целевой переменной
    - 2.7 Формирование новых признаков
    - 2.8 Вывод
3.  Исследовательский анализ данных 
    - 3.1 Phik-корреляция
    - 3.2 Итоговый выбор признаков
    - 3.3 Вывод
4.  Подготовка выборок для обучения
5.  Обучение моделей
    - 5.1 RandomForestClassifier
    - 5.2 CatboostClassifier
    - 5.3 Полносвязная нейронная сеть
6.  Тестирование модели
7.  Анализ feature importance, выводы, рекомендации 


## Цель исследования:

Научиться прогнозировать отток клиентов. Если выяснится, что пользователь планирует уйти, ему будут предложены промокоды и специальные условия. Команда оператора собрала персональные данные о некоторых клиентах, информацию об их тарифах и договорах. Значение метрики ROC-AUC должно быть не менее 0.85.

## Итог исследования:

В этом проекте была создана модель для прогнозирования оттока клиентов оператора связи

Проект включал следующие этапы:

- первичное изучение таблиц

- подключение к базе данных

- краткий обзор таблиц, доступных в базе данных (согласование их содержимого с бизнес-условием)

- предварительная обработка данных

- подготовка набора данных для обучения модели

- выбор признаков, участвующих в моделировании (+ добавление дополнительных признаков)

- работа с дубликатами и пропусками

- анализ исследовательских данных

- изучение количественных и категориальных признаков, анализ зависимостей в данных о целевом признаке, подготовка данных для модели прогнозирования оттока

- масштабирование количественных и кодирование категориальных признаков

- выделение тестовой выборки, обучение и поиск лучшей модели


## Выводы
Модель CatboostClassifier с параметрами{'depth': 6, 'l2_leaf_reg': 7, 'learning_rate': 0.03}решает задачу заказчика и позволяет предсказывать отток клиентов. Метрика ROC-AUC на тестовой выборке превышает планку в 0,856.​Модель может быть улучшена при помощи ещё более детального EDA и выявления существенных факторов, влияющих на разрыв договора.​Анализ feature importances показал, что компании в первую очередь стоит обратить внимание на клиентов, пользующихся помесячной оплатой услуг интернета и стриминговых платформ — именно они чаще всего прекращают действие договоров.Модель CatboostClassifier с параметрами
{'depth': 6, 'l2_leaf_reg': 7, 'learning_rate': 0.03}

решает задачу заказчика и позволяет предсказывать отток клиентов. Метрика ROC-AUC на тестовой выборке превышает планку в 0,856.

Модель может быть улучшена при помощи ещё более детального EDA и выявления существенных факторов, влияющих на разрыв договора.

Анализ feature importances показал, что компании в первую очередь стоит обратить внимание на клиентов, пользующихся помесячной оплатой услуг интернета и стриминговых платформ — именно они чаще всего прекращают действие договоров.


## Стек технологий:

`pandas`, `matplotlib`, `numpy`, `seaborn`, `sqlalchemy`, `ydata-profiling`, `phik`, `torch`, `keras`, `RandomForestClassifier`, `CatBoostClassifier`, `OneHotEncoder`, `StandardScaler`, `GridSearchCV`

