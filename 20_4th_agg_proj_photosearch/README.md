# Поиск референсных фотографий для фотографов

Описание проекта

Вы работаете в фотохостинге для профессиональных фотографов «Со Смыслом» (“With Sense”). 
Ваши пользователи размещают свои фотографии на хостинге и сопровождают их полным описанием: указывают место съёмок, модель камеры и т. д. Отличительная особенность сервиса — описание: его может предоставить не только тот, кто размещает фотографию, но и другие пользователи портала. Например, для этой фотографии

![Пример фотографии](https://github.com/vadimprimakov/Yandex_practicum_DS_Plus/blob/main/20_search_photos/20_example_1.jpeg)

описание выглядит так:

⎢ A hiker poses for a picture in front of stunning mountains and clouds. 

Ваш отдел занимается экспериментом по разработке поиска референсных фотографий для фотографов. Суть поиска заключается в следующем: пользователь сервиса вводит описание нужной сцены. Например, такое:

⎢ A man is crossing a mountain pass on a metal bridge.

Сервис выводит несколько фотографий с такой же или похожей сценой.

Чтобы эксперимент получил право на жизнь, нужно защитить его перед руководителем компании. Для защиты необходимо презентовать так называемый PoC (Proof of Concept, Проверка концепции) — продемонстрировать, что такой проект практически осуществим. Вам поручено разработать демонстрационную версию поиска изображений по запросу.
Для демонстрационной версии нужно выбрать лучшую  модель, которая получит векторное представление изображения, векторное представление текста, а на выходе выдаст число от 0 до 1 — и покажет, насколько текст и картинка подходят друг другу. 
На основе лучшей модели можно будет собрать предварительную версию продукта, которую вы покажете руководителю компании.

**Юридические ограничения**

В некоторых странах, где работает компания With Sense, действуют ограничения по обработке изображений: поисковым сервисам и сервисам, предоставляющим возможность поиска, запрещено без разрешения родителей или законных представителей предоставлять любую информацию, в том числе, но не исключительно, текстов, изображений, видео и аудио, содержащие описание, изображение или запись голоса детей. Ребёнком считается любой человек, не достигший 16-ти лет.
В вашем сервисе строго следуют законам стран, в которых работают. Поэтому при попытке посмотреть изображения, запрещённые законодательством, вместо картинок показывается дисклеймер:

⎢ This image is unavailable in your country in compliance with local laws.

Однако у вас в PoC нет возможности воспользоваться данным функционалом. Поэтому необходимо очистить данные от проблемного контента. Во время тестирования модели при появлении в запросе “вредного” контента должен отображаться дисклеймер. 

**Описание данных**
В файле train_dataset.csv находится информация, необходимая для обучения: имя файла изображения, идентификатор описания и текст описания. Для одной картинки может быть доступно до 5 описаний. Идентификатор описания имеет формат <имя файла изображения>#<порядковый номер описания>.

В папке train_images содержатся изображения для тренировки модели.

В файле CrowdAnnotations.tsv  — данные по соответствию изображения и описания, полученные с помощью краудсорсинга. Номера колонок и соответствующий тип данных:
- Имя файла изображения.
- Идентификатор описания.
- Доля людей, подтвердивших, что описание соответствует изображению.
- Количество человек, подтвердивших, что описание соответствует изображению.
- Количество человек, подтвердивших, что описание не соответствует изображению.

В файле ExpertAnnotations.tsv  — данные по соответствию изображения и описания, полученные в результате опроса экспертов. Номера колонок и соответствующий тип данных:
- Имя файла изображения.
- Идентификатор описания.
- 3, 4, 5 — оценки трёх экспертов. 

Эксперты ставят оценки по шкале от 1 до 4, где 1 — изображение и запрос совершенно не соответствуют друг другу, 2 — запрос содержит элементы описания изображения, но в целом запрос тексту не соответствует, 3 — запрос и текст соответствуют с точностью до некоторых деталей, 4 — запрос и текст соответствуют полностью.      
В файле test_queries.csv находится информация, необходимая для тестирования: идентификатор запроса, текст запроса и релевантное изображение. Для одной картинки может быть доступно до 5 описаний. Идентификатор описания имеет формат <имя файла изображения>#<порядковый номер описания>.

В папке test_images содержатся изображения для тестирования модели.
При решении задачи используйте только фреймворк Pytorch.

Инструкция по выполнению проекта

1. Шаг 1. Загрузите данные и проведите исследовательский анализ данных
Скачайте и откройте файлы с данными. Проверьте данные и откорректируйте их, если потребуется.
    - Напечатайте на экране 10–15 фотографий и посмотрите, как устроен датасет.
2. Шаг 2. Подготовьте данные к обучению модели
    - Создайте список слов которые, по вашему мнению, могут попадать под юридические ограничения.
    - Исключите из обучающего датасета пары, которые, исходя из подготовленного вами списка слов, могут попадать под юридические ограничения.
    - Сделайте векторизацию текстового описания методом BERT.
    - Сделайте векторизацию изображений с использованием модели ResNet18 из библиотеки Keras или PyTorch.
    - Дайте описание получившихся пар векторов с точки зрения их размерностей.
3. Обучите модель
- Создайте модель, которая покажет близость двух векторов. Модель должна принимать на вход конкатенированный вектор, состоящий из векторов описания и изображений, и предсказывать итоговую оценку экспертов.
- Выберите метрику, по которой вы будете сравнивать точность различных моделей.
- Обучите несколько моделей и подберите их гиперпараметры. В качестве моделей обязательно нужно рассмотреть:
    - Линейную регрессию;
    - Полносвязные нейронные сети.
4. Тестирование модели и демонстрация ее работы
- Проведите тестирование лучшей модели на тестовых данных.
- Напишите функцию, которая принимает на вход текстовое описание, делает его векторизацию и возвращает картинку с максимальным значением метрики.
(💡 Если запрос ведёт на юридически вредный контент, функция должна выводить дисклеймер.)
- С помощью написанной вами функции протестируйте работу модели на нескольких текстовых описаниях: проверьте, какие картинки она выдает при различных текстовых запросах.
5. Сделайте общий вывод по работе
Опишите модель, которая лучше всего справляется с задачей сравнения сходства картинки и текста. Опишите, какие ошибки допускает модель во время поиска картинки по её текстовому описанию. Оцените, насколько проект по созданию сервиса поиска фотографий по текстовому описанию практически осуществим.    


Содержание

1.  Исследовательский анализ данных
    - 1.1  Загрузка библиотек
    - 1.2  Загрузка датасетов
2.  Агрегация оценок
3.  Проверка данных
4.  Векторизация изображения
5.  Векторизация текстов
6.  Объединение векторов
7.  Обучение модели предсказания соответсвия
    - 7.1  LinearRegression
    - 7.2  ElasticNet
    - 7.3  CatBoost
8.  Тестирование модели


## Итог исследования:

В данной работе мы делали прототип для системы поиска изображений по фотографии.

В ходе работы для векторизации изображений мы использовали сеть ResNet18, а для текстовых эмбеддингов TfIDF.

После объединения признаков и выделения целей (экспертные оценки схожести описания и картинок), мы исследовали три модели для оценки схожести:

   * LinearRegression
   * ElasticNet
   * Catboost

Лучше всего себя показал Catboost, на нём мы протестировали модель.

В конце работы мы написали функцию которая по тексту возвращает 10 наиболее похожих картинок и протестировали её на предложенном наборе тестовых картинок.

Модель работает не так как хотелось бы, в большинстве случаев в топ выдачи попадает неверные картинки. 

Вероятно, причиной этому — низкое качество признаков и, как следствие, недоученные модели.

## Стек технологий:

`pandas`, `matplotlib`, `numpy`, `math`, `nltk`, `ResNet18`, `torch`, `torchvision`, `GroupShuffleSplit`, `TfidfVectorizer`, `ElasticNet`
   
